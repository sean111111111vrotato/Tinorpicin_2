<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>2048 Infinite</title>
<style>
  body {
    background: #faf8ef;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  h1 {
    margin: 20px;
    color: #776e65;
  }
  #game-container {
    width: 500px;
    height: 500px;
    margin: 20px auto;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-gap: 10px;
    background: #bbada0;
    padding: 10px;
    border-radius: 10px;
  }
  .tile {
    width: 100%;
    aspect-ratio: 1/1;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #cdc1b4;
    border-radius: 5px;
    font-size: 28px;
    font-weight: bold;
    color: #776e65;
  }
</style>
</head>
<body>
  <h1>2048 Until 2<sup>64</sup></h1>
  <div id="game-container"></div>

<script>
const gridSize = 4;
let grid = [];

function init() {
  grid = Array(gridSize).fill().map(() => Array(gridSize).fill(0));
  addTile();
  addTile();
  draw();
}

function addTile() {
  let empty = [];
  for (let r = 0; r < gridSize; r++) {
    for (let c = 0; c < gridSize; c++) {
      if (grid[r][c] === 0) empty.push({r, c});
    }
  }
  if (empty.length) {
    let spot = empty[Math.floor(Math.random() * empty.length)];
    grid[spot.r][spot.c] = Math.random() < 0.9 ? 2 : 4;
  }
}

function draw() {
  const container = document.getElementById('game-container');
  container.innerHTML = '';
  for (let r = 0; r < gridSize; r++) {
    for (let c = 0; c < gridSize; c++) {
      let tile = document.createElement('div');
      tile.className = 'tile';
      if (grid[r][c] !== 0) {
        tile.textContent = grid[r][c];
        tile.style.background = getTileColor(grid[r][c]);
      } else {
        tile.textContent = '';
        tile.style.background = '#cdc1b4';
      }
      container.appendChild(tile);
    }
  }
}

function getTileColor(value) {
  const colors = {
    2: "#eee4da", 4: "#ede0c8", 8: "#f2b179", 16: "#f59563",
    32: "#f67c5f", 64: "#f65e3b", 128: "#edcf72", 256: "#edcc61",
    512: "#edc850", 1024: "#edc53f", 2048: "#edc22e"
  };
  return colors[value] || "#3c3a32";
}

function slide(row) {
  let arr = row.filter(v => v !== 0);
  for (let i = 0; i < arr.length-1; i++) {
    if (arr[i] === arr[i+1]) {
      arr[i] *= 2;
      arr[i+1] = 0;
    }
  }
  arr = arr.filter(v => v !== 0);
  while (arr.length < gridSize) arr.push(0);
  return arr;
}

function rotateGrid() {
  let newGrid = Array(gridSize).fill().map(()=>Array(gridSize).fill(0));
  for (let r = 0; r < gridSize; r++) {
    for (let c = 0; c < gridSize; c++) {
      newGrid[c][gridSize-1-r] = grid[r][c];
    }
  }
  grid = newGrid;
}

function move(dir) {
  let old = JSON.stringify(grid);
  for (let i = 0; i < dir; i++) rotateGrid();
  for (let r = 0; r < gridSize; r++) grid[r] = slide(grid[r]);
  for (let i = 0; i < (4-dir)%4; i++) rotateGrid();
  if (JSON.stringify(grid) !== old) {
    addTile();
    draw();
  }
}

document.addEventListener('keydown', (e) => {
  if (e.key === "ArrowLeft" || e.key.toLowerCase() === "a") move(0);
  if (e.key === "ArrowUp"   || e.key.toLowerCase() === "w") move(1);
  if (e.key === "ArrowRight"|| e.key.toLowerCase() === "d") move(2);
  if (e.key === "ArrowDown" || e.key.toLowerCase() === "s") move(3);
});

init();
</script>
</body>
</html>
